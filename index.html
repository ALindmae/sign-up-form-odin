<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Sign up </title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>
    <div class="sign-up-page">
            <div class="sign-up-visual">
                <div class="logo-wrapper">
                    <img src="./images/odin-lined.png" alt="" class="odin-logo">
                    <p class="logo-text">ODIN</p>
                </div>
            <p class="photo-credit">Photo by Cup of Couple on Pexels</p>
        </div>
        <div class="form-container">
            <div class="slogan-container">
                <h1 class="sign-up-slogan">
                    This is not a real online service! You know you need something like this in your life to help you realize your deepest dreams. <br>Sign up <i>now</i> to get started.
                    <span class="slogan-emphasis">You <i>know</i> you want to.</span>
                </h1>
            </div>
            <div>
                <form action="" method="post">
                    <div class="form-wrapper">
                        <div class="form-heading">
                            <h2> Let's do this!</h2>
                        </div>
                        <div class="form-group">
                            <label for="first-name"> FIRST NAME* </label>
                            <input type="text" name="first-name" required minlength="2" maxlength="25">
                            <div class="error message" id="first-name-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="last-name"> LAST NAME* </label>
                            <input type="text" name="last-name" required minlength="2" maxlength="25">
                            <div class="error message" id="last-name-error"></div>
                        </div>

                        <div class="form-group">
                            <label for="email"> EMAIL* </label>
                            <input type="email" name="email" required>
                            <div class="error message" id="email-error"></div>
                        </div>

                        <div class="form-group">
                            <label for="phone-number"> PHONE NUMBER </label>    
                            <input type="tel" name="phone-number" pattern="\+?\d{5,11}">
                            <div class="error message" id="phone-number-error"></div>
                        </div>

                        <div class="form-group">
                            <label for="password"> PASSWORD* </label>
                            <input type="password" name="password" required>
                            <div class="error message" id="password-error"></div>
                            <div class="requirements helper" id="password-conditions"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm-password"> CONFIRM PASSWORD* </label>
                            <input type="password" name="confirm-password" required>
                            <div class="error message" id="confirm-password-error"></div>
                        </div>
                    </div>
                <div class="form-actions">
                    <button type="submit"> Create Account </button>
                    <p class="redirect-text"> Already have an account? <a href="" class="redirect-link"> Log in!</a></p>
                </div>
                </form>
            </div>
        </div>
    </div>
        <script>

            const passwordRequirementsHTML = `
                <span class="requirements title">For your security, create a password with at least:</span><br>
                <span class="pw-rule pw-lowercase">
                    <i class="icon fa-regular fa-circle-xmark"></i> One lowercase letter
                </span><br>
                <span class="pw-rule pw-uppercase">
                    <i class="icon fa-regular fa-circle-xmark"></i> One uppercase letter
                </span><br>
                <span class="pw-rule pw-number">
                    <i class="icon fa-regular fa-circle-xmark"></i> One number
                </span><br>
                <span class="pw-rule pw-special">
                    <i class="icon fa-regular fa-circle-xmark"></i> One special character (e.g., @ ! $ & #)
                </span><br>
                <span class="pw-rule pw-length">
                    <i class="icon fa-regular fa-circle-xmark"></i> 8 or more characters
                </span>
            `;
     
            let passwordInput = document.querySelector("[name='password']");
            let requirementsContainer = document.querySelector('.requirements.helper');
            let validationRules = [];
            let validPassword = false;

            // Show password requirements on focus
            passwordInput.addEventListener('focus', (event) => {
                if (passwordInput.value == '') {
                    requirementsContainer.innerHTML = passwordRequirementsHTML;
                    requirementsContainer.classList.add('active');
                }

                validationRules = [
                    { regex: /[a-z]/, element: document.querySelector(".pw-rule.pw-lowercase") },
                    { regex: /[A-Z]/, element: document.querySelector(".pw-rule.pw-uppercase") },
                    { regex: /\d/, element: document.querySelector(".pw-rule.pw-number") },
                    { regex: /[^A-Za-z0-9\s]/, element: document.querySelector(".pw-rule.pw-special") },
                    { regex: /.{8}/, element: document.querySelector(".pw-rule.pw-length") },
                    ];
            });

            // Toggle condition matches colors
            passwordInput.addEventListener('input', (event) => {

                let checkIconClass = "icon fa-regular fa-circle-check";
                let xIconClass = "icon fa-regular fa-circle-xmark";

                for (const condition of validationRules) {
                    const icon = condition.element.children[0];
                    const isValid = condition.regex.test(passwordInput.value);
                    icon.classList = isValid ? checkIconClass : xIconClass;
                    condition.element.style.color = isValid ? "green" : "grey";
                    validPassword = isValid ? true : false;
                }
            });

            // Check error & toggle message at focusout
            let form = document.querySelector('.form-wrapper');
            form.addEventListener('focusout', (event) => {
                let excIconTag = '<i class="fa-solid fa-triangle-exclamation"></i>';
                let targetName = event.target['name'];
                let errorContainer = document.querySelector(`#${targetName}-error`);

                // extract regular field name of the target name value, to use in error display
                let fieldName = targetName.includes('-') ? targetName.split(/^\w*-/)[1] : targetName;

                // Compare 'password' and 'confirm password' fields for match
                if (event.target['name'] === 'confirm-password' && event.target.value !== '') {
                    let password = document.querySelector("[name='password']");

                    // Display error if not match
                    if (event.target.value != password.value) {
                        event.target.classList.add('error');
                        errorContainer.innerHTML = excIconTag + 'Passwords do not match';
                    }

                    else {
                        errorContainer.textContent = '';
                        event.target.classList.remove('error');
                    }
                }

                // Display error if password not valid
                else if (event.target['name'] === 'password' && !(validPassword)) {
                    console.log(validPassword);
                    errorContainer.innerHTML = excIconTag + `Please enter a valid ${fieldName}!`;
                    event.target.classList.add('error');
                }

                // Display error if any other field other than password is not valid
                else if (event.target['name'] !== 'password' && !(event.target.checkValidity())) {
                    errorContainer.innerHTML = excIconTag + `Please enter a valid ${fieldName}!`;
                    event.target.classList.add('error');
                }

                else {
                    errorContainer.textContent = '';
                    event.target.classList.remove('error');
                }
            })
    </script>
</body>
</html>